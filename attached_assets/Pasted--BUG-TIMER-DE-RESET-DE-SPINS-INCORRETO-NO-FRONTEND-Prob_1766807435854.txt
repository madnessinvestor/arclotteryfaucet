ğŸš¨ BUG â€“ TIMER DE RESET DE SPINS INCORRETO NO FRONTEND
âŒ Problema atual

O timer exibido no frontend para o reset das tentativas de spin nÃ£o reflete o estado real do contrato.

Sintoma visÃ­vel:

O frontend mostra:

Reset in: 00:00:00
Next 20 spins available soon


PorÃ©m a wallet ainda nÃ£o pode girar ou o tempo exibido nÃ£o corresponde ao tempo real do contrato.

Isso gera:

UX incorreta

ConfusÃ£o para o usuÃ¡rio

DessincronizaÃ§Ã£o entre UI e blockchain

ğŸ” Causa do problema

O frontend nÃ£o estÃ¡ usando corretamente o tempo on-chain e provavelmente estÃ¡:

âŒ Calculando o timer com base em horÃ¡rio local

âŒ Usando Date.now() como fonte de verdade

âŒ Fazendo cache de estado

âŒ NÃ£o tratando corretamente o retorno da funÃ§Ã£o nextReset(address)

âœ… CORREÃ‡ÃƒO OBRIGATÃ“RIA (COM BASE NO CONTRATO)

O contrato ArcSpinLottery jÃ¡ fornece exatamente o tempo correto para o reset atravÃ©s da funÃ§Ã£o:

function nextReset(address user) external view returns (uint256)


Essa funÃ§Ã£o retorna:

0 â†’ spins jÃ¡ resetados (usuÃ¡rio pode girar)

> 0 â†’ segundos restantes atÃ© liberar mais 20 spins

ğŸ› ï¸ IMPLEMENTAÃ‡ÃƒO CORRETA NO FRONTEND
1ï¸âƒ£ Fonte ÃšNICA do timer

O timer DEVE usar exclusivamente:

nextReset(userAddress)


ğŸš« Ã‰ proibido:

Calcular tempo manualmente

Inferir reset por horÃ¡rio local

Usar timestamps prÃ³prios

2ï¸âƒ£ LÃ³gica correta do timer
const secondsRemaining = await contract.nextReset(user);

if (secondsRemaining === 0) {
  mostrar: "Spins disponÃ­veis"
} else {
  converter secondsRemaining para HH:MM:SS
  atualizar contador regressivo
}


ğŸ“Œ O valor retornado jÃ¡ estÃ¡ em segundos
ğŸ“Œ NÃ£o deve ser ajustado manualmente

3ï¸âƒ£ AtualizaÃ§Ã£o do contador (tempo real)

O frontend pode:

Buscar nextReset() a cada X segundos OU

Buscar uma vez e fazer countdown local SEM alterar o valor base

Exemplo correto:

baseSeconds = nextReset()
contador = baseSeconds - tempo_decorrido


Se o contador chegar a 0, o frontend DEVE:

Reconsultar spinsLeft(user)

Reconsultar nextReset(user)

4ï¸âƒ£ ExibiÃ§Ã£o correta no frontend
Quando nextReset > 0:
Reset in: HH:MM:SS
Next 20 spins available after reset

Quando nextReset == 0:
20 spins available


â— Nunca mostrar 00:00:00 se o usuÃ¡rio ainda nÃ£o pode girar
â— Nunca inferir reset apenas pelo timer local

5ï¸âƒ£ SincronizaÃ§Ã£o obrigatÃ³ria pÃ³s-spin

ApÃ³s cada spin confirmado:

- Reconsultar nextReset(user)
- Reconsultar spinsLeft(user)
- Reiniciar o timer com os valores do contrato


ğŸš« NÃ£o reutilizar valores antigos

ğŸ§ª CRITÃ‰RIO DE ACEITAÃ‡ÃƒO (OBRIGATÃ“RIO)

A correÃ§Ã£o sÃ³ Ã© considerada concluÃ­da quando:

âœ” O timer reflete exatamente nextReset(user)

âœ” Nunca mostra 00:00:00 antes do reset real

âœ” Quando o contrato libera spins, a UI atualiza corretamente

âœ” O tempo exibido Ã© consistente entre refresh de pÃ¡gina

âœ” Nenhuma lÃ³gica de horÃ¡rio local decide o reset