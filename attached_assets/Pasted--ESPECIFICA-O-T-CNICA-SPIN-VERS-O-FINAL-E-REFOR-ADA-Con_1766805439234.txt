ğŸ“˜ ESPECIFICAÃ‡ÃƒO TÃ‰CNICA â€“ SPIN (VERSÃƒO FINAL E REFORÃ‡ADA)

Contrato: ArcSpinLottery.sol
Regra fundamental: A roleta DEVE parar exatamente no prÃªmio definido on-chain.

ğŸš¨ REGRA ABSOLUTA (OBRIGATÃ“RIA)

O resultado do spin Ã© decidido exclusivamente pelo contrato inteligente.
A animaÃ§Ã£o da roleta nÃ£o pode, em hipÃ³tese alguma:

Sortear prÃªmio

Ajustar prÃªmio

Corrigir resultado

â€œSimularâ€ vitÃ³ria

A roleta deve parar exatamente no segmento correspondente ao resultado emitido no evento SpinPlayed.

1ï¸âƒ£ DISPARO DO SPIN (Frontend)
UsuÃ¡rio clica em "Spin"
â””â”€ Frontend consulta apenas dados ON-CHAIN:
   â”œâ”€ spinsLeft(user) > 0
   â”œâ”€ USDC.balanceOf(contract) â‰¥ 1000 USDC
â””â”€ Frontend gera uint256 random (32 bytes)
â””â”€ Frontend chama spin(random)
â””â”€ UsuÃ¡rio confirma a transaÃ§Ã£o na carteira


â— Nenhum cÃ¡lculo de prÃªmio ocorre aqui

2ï¸âƒ£ EXECUÃ‡ÃƒO ON-CHAIN (Contrato)
Contrato executa spin(random)
â””â”€ Calcula roll = random % 100
â””â”€ Determina reward conforme tabela fixa
â””â”€ Transfere USDC
â””â”€ Emite evento SpinPlayed(player, reward, random, timestamp)


ğŸ“Œ Esse evento define o resultado FINAL e IMUTÃVEL

3ï¸âƒ£ EVENTO = RESULTADO FINAL
ğŸ”¹ Fonte Ãºnica de verdade
SpinPlayed(
  address player,
  uint256 reward,
  uint256 random,
  uint256 timestamp
)

Frontend DEVE:
â””â”€ Ler o evento SpinPlayed
â””â”€ Usar EXCLUSIVAMENTE esse evento
â””â”€ Ignorar qualquer estado local


â— Se o evento indicar reward = 0, a roleta DEVE parar no segmento 0
â— Se indicar reward = 100 USDC, a roleta DEVE parar no segmento 100

4ï¸âƒ£ MAPEAMENTO OBRIGATÃ“RIO (CONTRATO â†’ ROLETA)
ğŸ”¹ Regra tÃ©cnica
roll = random % 100

ğŸ”¹ Tabela EXATA (idÃªntica ao contrato)
0â€“1    â†’ 1000 USDC
2â€“4    â†’ 200 USDC
5â€“14   â†’ 100 USDC
15â€“24  â†’ 50 USDC
25â€“44  â†’ 20 USDC
45â€“59  â†’ 10 USDC
60â€“99  â†’ 0 USDC


ğŸ“Œ Esse mapeamento:

NÃ£o Ã© opcional

NÃ£o Ã© interpretÃ¡vel

Deve ser exatamente igual ao contrato

5ï¸âƒ£ ANIMAÃ‡ÃƒO DA ROLETA (OBRIGAÃ‡ÃƒO TÃ‰CNICA)
ğŸ”¹ Fluxo obrigatÃ³rio
Evento SpinPlayed recebido
â””â”€ Extrair random
â””â”€ Calcular roll = random % 100
â””â”€ Mapear roll â†’ Ã­ndice fixo da roleta
â””â”€ Calcular Ã¢ngulo final EXATO
â””â”€ Executar animaÃ§Ã£o
â””â”€ Parar exatamente no Ã­ndice correspondente


ğŸš¨ A animaÃ§Ã£o DEVE SER DETERMINÃSTICA
ğŸš¨ Nunca pode parar em outro segmento

6ï¸âƒ£ PROIBIÃ‡Ã•ES EXPLÃCITAS

ğŸš« Ã‰ PROIBIDO:

Sortear segmento no frontend

Ajustar Ã¢ngulo â€œpara ficar bonitoâ€

Reatribuir segmento por valor

Usar funÃ§Ãµes auxiliares nÃ£o baseadas no evento

Usar fallback visual diferente do resultado real

7ï¸âƒ£ ATUALIZAÃ‡ÃƒO DE ESTADO PÃ“S-SPIN
ApÃ³s a roleta parar:
â””â”€ Atualizar spinsLeft(user)
â””â”€ Atualizar nextReset(user)
â””â”€ Atualizar USDC.balanceOf(contract)
â””â”€ Atualizar USDC.balanceOf(user)


ğŸ“Œ Tudo vindo do blockchain

8ï¸âƒ£ CRITÃ‰RIO DE ACEITAÃ‡ÃƒO (CHECKLIST)

O ajuste sÃ³ Ã© aceito se:

âœ” O evento SpinPlayed define o prÃªmio

âœ” A roleta para exatamente no segmento do contrato

âœ” Reward zero para exatamente no segmento zero

âœ” NÃ£o existe lÃ³gica paralela de resultado

âœ” Nunca hÃ¡ divergÃªncia entre evento e UI

ğŸ”š TEXTO FINAL CURTO (SE PRECISAR)

Garantir que a roleta sempre pare exatamente no resultado definido pelo contrato ArcSpinLottery, usando exclusivamente o evento SpinPlayed como fonte de verdade, sem qualquer lÃ³gica off-chain de decisÃ£o ou correÃ§Ã£o visual.